<script>
import wepy from 'wepy'
import 'wepy-async-function'
import Promise from 'promise-polyfill'
import _ from 'lodash'
import host from './config.js'
export default class extends wepy.app {
  config = {
    pages: [
      'pages/index',
      'pages/profile',
      'pages/map',
      'pages/detail',
      'pages/plant',
      'pages/pick',
      'pages/tandian',
      'pages/articlelist',
      'pages/share',
      'pages/comment'
      // 'pages/topic',
      // 'pages/topicdetail'
    ],
    tabBar: {
      selectedColor: "#fa6650",
      backgroundColor: "#ffffff",
      borderStyle:"white",
      list: [{
        pagePath: "pages/index",
        text: "美食",
        iconPath: "resources/home_light.png",
        selectedIconPath: "./resources/home_fill_light.png"
      },{
        pagePath: "pages/articlelist",
        text: "探店",
        iconPath: "resources/discover.png",
        selectedIconPath: "./resources/discover_fill.png"
      },{
        pagePath: "pages/profile",
        text: "我的",
        iconPath: "resources/my_light.png",
        selectedIconPath: "resources/my_fill_light.png"
      }]
    },
    window: {
      backgroundTextStyle: 'light',
      navigationBarBackgroundColor: '#fff',
      navigationBarTitleText: 'WeChat',
      navigationBarTextStyle: 'black'
    }
  }

  globalData = {
    userInfo: null,
    all: [],
    index: 0,
    sorted: false,
    orders: 'asc',
    selected: 'hotel',
    plant: [],
    pick: [],
    nickName: '',
    avatarUrl: '',
    comments: []
  }

  constructor () {
    super()
    this.use('promisify')
    this.use('requestfix')
  }

  // 初始化数据
  onLaunch () {
    this.login()
  }

  // 检查登录是否过期
  checkSession(){
    return new Promise((resolve, reject) => {
      wx.checkSession({
        success:function(){
          resolve(true)
        },
        fail:function(){
          reject('请重新登录')
        }
      })
    })
  }

  // 登录并返回key
  login(){
    var that = this
    return new Promise((resolve,reject) => {
      wx.login({
        success: function(res){
          wx.request({
            url: host.service.loginUrl,
            method: 'POST',
            data: {
              code: res.code
            },
            success: function(res){
              wx.setStorage({
                key:'key',
                data: res.data.key
              })
              resolve(res)
            }
          })
        }
      })
    })
  }

  // 封装登录之后的请求
  ajax(url,method="GET",data,config={}){ 
    let key = wx.getStorageSync('key')
    if(!key){
      return new Promise((resolve,reject) => {
        this.login()
        reject('请登录')
      })
    } else {
      return new Promise((resolve,reject) =>{
        this.checkSession().then(_=>{
          if(_){
            wx.request({
              url,
              method:method.toLocaleUpperCase(),
              data,
              header: Object.assign({},{key},config),
              success: (ret) =>{
                resolve(ret.data)
              }
            })
          } else {
            this.login()
            reject('session_key失效')
          }
        })
      })
    }
  }
}
</script>
<style lang="less">
html,body,page{
  height: 100%
}
.container{
  height:100%;
  position:relative
}
.content{
  position: absolute;
  left: 0;
  top: 49px;
  right: 0;
  bottom:0;
}
.container {
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  box-sizing: border-box;
}

@font-face {
    font-family: 'iconfont';
    src: url(data:font/truetype;charset=utf-8;base64,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) format('truetype');
    font-weight: normal;
    font-style: normal;
}

.iconfont {
  font-family:"iconfont" !important;
  font-size:16px;
  font-style:normal;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

.icon-favorfill:before { content: "\e64b"; }

.icon-locationfill:before { content: "\e650"; }

.icon-unfold:before { content: "\e661"; }

.icon-likefill:before { content: "\e668"; }

.icon-right:before { content: "\e6a3"; }

.icon-discoverfill:before { content: "\e6ba"; }

.icon-message:before { content: "\e6bc"; }

.icon-fold:before { content: "\e6de"; }

.icon-rechargefill:before { content: "\e6ec"; }

.icon-message1:before { content: "\e7c6"; }

.icon-share:before { content: "\e601"; }

.icon-phonecall:before { content: "\e613"; }

.icon-triangledownfill:before { content: "\e79b"; }

.icon-triangleupfill:before { content: "\e79c"; }

.icon-share_light:before { content: "\e7e0"; }

.icon-comment_light:before { content: "\e7e1"; }

.icon-favor_light:before { content: "\e7e2"; }

.icon-shoucang:before { content: "\e86d"; }

.icon-xihuan:before { content: "\e86f"; }

.icon-xihuan1:before { content: "\e870"; }

.icon-phone_light:before { content: "\e7fe"; }

.icon-wodetijiao:before { content: "\e6d3"; }

.selectarea{
  height:50px;
  position: fixed;
  width: 100%;
  left: 0;
  top: 0;
  background: #fff
}
.nav-left,.nav-right{
  position: absolute;
  height: 50px;
  padding-left: 15px;
  padding-right: 15px;
  top: 0;
  line-height: 50px;
}
.nav-left{
  left:0;
}
.nav-right{
  right:0;
}

.comment-list{
  padding: 20rpx 40rpx 50rpx 40rpx;
}
.comment-part{
  padding-bottom:10rpx;
  font-size:18px;
  font-weight:bold;
}
.mainComment{
  overflow: hidden;
  padding-top:20rpx;
  padding-bottom:20rpx;
  border-top:1px solid #e9e9e9;
  position: relative;
}
.authorinfo{
  float: left;
  width:80rpx;
  height:80rpx;
  border-radius: 50%;
  overflow: hidden;
}
.avatar{
  width:80rpx;
  height:80rpx;
}

.comment_content{
  margin-left: 100rpx;
  margin-right:80rpx;
  position: relative;
}
.author_name{
  font-size:14px;
  color:#666;
  padding-top: 10rpx;
}
.comment_time{
  font-size:12px;
  color:#999;
  padding-bottom:10rpx;
}
.comment_msg{
  font-size:18px;
}

.comment_btn{
  position: absolute;
  right: 0;
  bottom:20rpx;
}
.comment_btn .share-btn{
  height: 40rpx;
  font-size:20px;
  line-height: normal;
  background: #fff;
}
.comment_btn .iconfont{
  position: relative;
  top:-10rpx;
  font-size:20px;
}
.nocomment{
  border-top:1px solid #e9e9e9;
  padding-top:80rpx;
  text-align: center;
  color:#777;
  font-size:16px;
}

.seperator{
  background: #f6f6f6;
  height:32rpx;
}

.subComment{
  margin-left:100rpx;
  padding:10rpx;
  background:#f6f6f6;
  margin-bottom:20rpx;
  border-radius: 8rpx;
  font-size:14px;
}

.subauthor{
  color:#666;
}
.subcontent{
  color:#999
}
</style>
